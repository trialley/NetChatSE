<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>åŸºäºAmaze UIä»¿å¾®ä¿¡ç”µè„‘ç‰ˆèŠå¤©æ ·å¼ - ç«™é•¿ç´ æ</title>
	<link rel="stylesheet" href="css/amazeui.min.css" />
	<link rel="stylesheet" href="css/main.css" />
</head>

<body>
	<div id="app" class="box">
		<div class="wechat">
			<div class="sidestrip">
				<div class="am-dropdown" data-am-dropdown>
					<!--å¤´åƒæ’ä»¶-->
					<div class="own_head am-dropdown-toggle"></div>
					<div class="am-dropdown-content">
						<div class="own_head_top">
							<div class="own_head_top_text">
								<p class="own_name">å½­äºæ™ä¸¶plus<img src="images/icon/head.png" alt="" /></p>
								<p class="own_numb">å¾®ä¿¡å·ï¼š123456</p>
							</div>
							<img src="images/own_head.jpg" alt="" />
						</div>
						<div class="own_head_bottom">
							<p><span>åœ°åŒº</span>æ±Ÿè¥¿ ä¹æ±Ÿ</p>
							<div class="own_head_bottom_img">
								<a href=""><img src="images/icon/head_1.png" /></a>
								<a href=""><img src="images/icon/head_2.png" /></a>
							</div>
						</div>
					</div>
				</div>
				<!--ä¸‰å›¾æ ‡-->
				<div class="sidestrip_icon">
					<a id="si_1" style="background: url(images/icon/head_2_1.png) no-repeat;"></a>
					<a id="si_2"></a>
					<a id="si_3"></a>
				</div>

				<!--åº•éƒ¨æ‰©å±•é”®-->
				<div id="doc-dropdown-justify-js">
					<div class="am-dropdown" id="doc-dropdown-js" style="position: initial;">
						<div class="sidestrip_bc am-dropdown-toggle"></div>
						<ul class="am-dropdown-content" style="">
							<li>
								<a href="#"
									data-am-modal="{target: '#doc-modal-1', closeViaDimmer: 0, width: 400, height: 225}">æ„è§åé¦ˆ</a>
								<div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-1">
									<div class="am-modal-dialog">
										<div class="am-modal-hd">Modal æ ‡é¢˜
											<a href="javascript: void(0)" class="am-close am-close-spin"
												data-am-modal-close>&times;</a>
										</div>
										<div class="am-modal-bd">
											Modal å†…å®¹ã€‚æœ¬ Modal æ— æ³•é€šè¿‡é®ç½©å±‚å…³é—­ã€‚
										</div>
									</div>
								</div>
							</li>

							<li><a href="#">å¤‡ä»½ä¸æ¢å¤</a></li>
							<li><a href="#">è®¾ç½®</a></li>
						</ul>
					</div>
				</div>
			</div>

			<!--èŠå¤©åˆ—è¡¨-->
			<div class="middle on">
				<div class="wx_search">
					<input type="text" placeholder="æœç´¢" />
					<button>+</button>
				</div>
				<div class="office_text">
					<ul class="user_list">
						<!-- <li :class=' item.sender==myid ?"me":"other"'><img
								:src="  item.sender==myid  ?senderurl:receiverurl" title="æ¥æ”¶æ–¹">
							<span></span>
						</li>
						<li>
							<div class="user_head"><img src="images/head/2.jpg" /></div>
							<div class="user_text">
								<p class="user_name">å¤ç»§æ¶›</p>
								<p class="user_message">[å°ç¨‹åº]</p>
							</div>
							<div class="user_time">ä¸Šåˆ 11ï¼š03</div>
						</li> -->
						<li v-for="item in chatList" @click="clickChat(item.id)" :toid="item.id" class="user_active">
							<div class="user_head"><img :src="item.ico_url" /></div>
							<div class="user_text">
								<p class="user_name">{{item.neckname}}({{item.id}})</p>
								<p class="user_message">{{item.last_info}}</p>
							</div>
							<div class="user_time">{{item.last_time}}</div>
						</li>

					</ul>
				</div>
			</div>

			<!--å¥½å‹åˆ—è¡¨-->
			<div class="middle">
				<div class="wx_search">
					<input type="text" placeholder="æœç´¢" />
					<button>+</button>
				</div>
				<div class="office_text">
					<ul class="friends_list">
						<li>
							<p>æ–°çš„æœ‹å‹</p>
							<div class="friends_box">
								<div class="user_head"><img src="images/head/1.jpg" /></div>
								<div class="friends_text">
									<p class="user_name">æ–°çš„æœ‹å‹</p>
								</div>
							</div>
						</li>
						<li>
							<p>å…¬ä¼—å·</p>
							<div class="friends_box">
								<div class="user_head"><img src="images/head/2.jpg" /></div>
								<div class="friends_text">
									<p class="user_name">å…¬ä¼—å·</p>
								</div>
							</div>
						</li>
						<li>
							<p>å¥½å‹</p>
							<div v-for="item in friendList" :toid="item.id" class="friends_box">
								<div class="user_head"><img :src="item.ico_url" /></div>
								<div class="friends_text">
									<p class="user_name">{{item.neckname}}({{item.id}})</p>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>

			<!--ç¨‹åºåˆ—è¡¨-->
			<div class="middle">
				<div class="wx_search">
					<input type="text" placeholder="æœç´¢æ”¶è—å†…å®¹" />
					<button>+</button>
				</div>
				<div class="office_text">
					<ul class="icon_list">
						<li class="icon_active">
							<div class="icon"><img src="images/icon/icon.png" alt="" /></div>
							<span>å…¨éƒ¨æ”¶è—</span>
						</li>
						<li>
							<div class="icon"><img src="images/icon/icon1.png" alt="" /></div>
							<span>é“¾æ¥</span>
						</li>
						<li>
							<div class="icon"><img src="images/icon/icon2.png" alt="" /></div>
							<span>ç›¸å†Œ</span>
						</li>
						<li>
							<div class="icon"><img src="images/icon/icon3.png" alt="" /></div>
							<span>ç¬”è®°</span>
						</li>
						<li>
							<div class="icon"><img src="images/icon/icon4.png" alt="" /></div>
							<span>æ–‡ä»¶</span>
						</li>
						<li>
							<div class="icon"><img src="images/icon/icon5.png" alt="" /></div>
							<span>éŸ³ä¹</span>
						</li>
						<li>
							<div class="icon"><img src="images/icon/icon6.png" alt="" /></div>
							<span>æ ‡ç­¾</span>
						</li>
					</ul>
				</div>
			</div>
			<!-- ä¾§è¾¹æ å†…å®¹ -->
			<div id="doc-oc-demo3" class="am-offcanvas">
				<div class="am-offcanvas-bar am-offcanvas-bar-flip">
					<div class="am-offcanvas-content">
						<p><a href="http://music.163.com/#/song?id=385554" target="_blank">ç½‘æ˜“éŸ³ä¹</a></p>
					</div>
				</div>
			</div>
			<!--èŠå¤©çª—å£-->
			<div class="talk_window">
				<!-- èŠå¤©é¡¶éƒ¨ -->
				<div class="windows_top">
					<div class="windows_top_box">
						<span>{{to_info.neckname}}({{to_info.id}})</span>
						<ul class="window_icon">
							<li><a href=""><img src="images/icon/icon7.png" /></a></li>
							<li><a href=""><img src="images/icon/icon8.png" /></a></li>
							<li><a href=""><img src="images/icon/icon9.png" /></a></li>
							<li><a href=""><img src="images/icon/icon10.png" /></a></li>
						</ul>
						<div class="extend" class="am-btn am-btn-success" data-am-offcanvas="{target: '#doc-oc-demo3'}">
						</div>

					</div>
				</div>

				<!--èŠå¤©å†…å®¹-->
				<div class="windows_body">
					<div class="office_text" style="height: 100%;">
						<ul class="content" id="chatbox">
							<li v-for="(item,index) in chatContentList"
								:class=' item.sender== my_info.id ?"me":"other" '>
								<img :src="  item.sender==my_info.id ? my_info.ico_url : to_info.ico_url " title=" æ¥æ”¶æ–¹">
								<span>{{item.message.content}}</span>
							</li>
						</ul>
					</div>
				</div>
				<!-- èŠå¤©åº•éƒ¨ -->
				<div class="windows_input" id="talkbox">
					<div class="input_icon">
						<a href="javascript:;"></a>
						<a href="javascript:;"></a>
						<a href="javascript:;"></a>
						<a href="javascript:;"></a>
						<a onclick="videocall()"></a>
						<a onclick="voicecall()"></a>
					</div>
					<div class="input_box">
						<textarea name="" rows="" cols="" id="input_box" v-model="text"></textarea>
						<button id="send">å‘é€ï¼ˆSï¼‰</button>
					</div>
				</div>
			</div>

			<!-- ç™»å½•çª—å£ -->
			<div id="container" v-show="login_show">
				<div id="output">
					<div class="containerT">
						<h1>ç”¨æˆ·ç™»å½•</h1>
						<div class="loginForm">
							<input v-model="logform.form1" type="text">
							<input v-model="logform.form2" type="text">
							<button class="login_but" @click="login">ç™»å½•</button>
							<div id="prompt" class="prompt" style="color:white" onclick="jumpToZHUCE()">å‰å¾€æ³¨å†Œ</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--è¯­éŸ³çª—å£ -->
	<div id="floatbox">
		<div v-if="show" id="voicepanal"
			style="width:280px;height:500px;margin:0px;overflow: hidden;position:relative;">
			<h3 style="top:0ps;left:0px;z-index: 999;position: absolute;">{{title}}</h3>
			<!-- <span class="lgtime">{{time}}</span> -->

			<div id="hangup" onclick="voiceclose()"></div>

		</div>
	</div>
	<!-- è§†é¢‘çª—å£ -->
	<div id="floatboxb">
		<div v-if="show" id="videopanal"
			style="width:280px;height:500px;margin:0px;overflow: hidden;position:relative;">
			<h3 style="top:0ps;left:0px;z-index: 999;position: absolute;">{{title}}</h3>
			<image style="z-index: 99;top:0ps;width:60%;height:60% ;position: absolute;" ondragstart="return false;"
				:src="mycam"></image>
			<image ondragstart="return false;" style=" top:0px;width:300%;height:300%; position: absolute;"
				:src="opcam"></image>
			<!-- <span class="lgtime"> {{time}}</span> -->

			<div id="hangup" onclick="videoclose()"></div>
		</div>
	</div>

	<!-- vue appéƒ¨åˆ† -->
	<script src="/js/neko.js"></script>
	<script src="https://cdn.bootcss.com/vue/2.6.10/vue.js"></script>
	<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
	<script>
		var chatapp = new Vue({
			el: '#app',
			data: {
				/*ç™»å½•ç•Œé¢*/
				logform: {
					form1: "root1",
					form2: "root2",
				},
				// return {
				/*é€šç”¨æ•°æ®*/
				login_show: true,//æ˜¯å¦æ˜¾ç¤ºç™»å½•é¡µé¢
				my_info: {
					id: "testid",
					neckname: "testneckname",
					sex: "ç”·",
					age: 16,
					ico_url: "https://randomuser.me/api/portraits/men/75.jpg"
				},


				/*å¥½å‹åˆ—è¡¨æ•°æ®*/
				friendList: [{
					id: "testtoid1",
					neckname: "testtoneckname1",
					ico_url: "https://randomuser.me/api/portraits/men/75.jpg",
				}, {
					id: "testtoid1",
					neckname: "testtoneckname1",
					ico_url: "https://randomuser.me/api/portraits/men/75.jpg",
				}
				],


				/*èŠå¤©åˆ—è¡¨æ•°æ®*/
				chatList: [{
					id: "testtoid1",
					neckname: "testtoneckname1",
					ico_url: "https://randomuser.me/api/portraits/men/75.jpg",
					last_info: " ç»™ğŸ‘´æ•´ç¬‘äº†",
					last_time: "æ˜¨å¤©"
				}, {
					id: "testtoid2",
					neckname: "testtoneckname2",
					ico_url: "https://randomuser.me/api/portraits/men/75.jpg",
					last_info: "æ±‚ä¸¤å—é’±äº¤ä¸ªè¯è´¹",
					last_time: "æ˜¨å¤©"
				}],


				/*èŠå¤©ç•Œé¢æ•°æ®*/
				websock: null,
				chatContentList: [{
					'type': 'user',
					'sender': "testid",
					'receiver': "testtoid1",
					'message': {
						'type': 'text',
						'content': 'text'
					}
				}, {
					'type': 'user',
					'sender': "testtoid1",
					'receiver': "testid",
					'message': {
						'type': 'text',
						'content': 'text'
					}
				}
				],
				to_info: {
					id: "testtoid1",
					neckname: "testtoneckname1",
					ico_url: "https://randomuser.me/api/portraits/men/75.jpg",
				},
				text: "",//èŠå¤©æ‰“å­—çª—å£

				// };
			},
			created: function () {
			},
			destroyed() {
			},
			methods: {
				login: function () {
					// `this` æŒ‡å‘ vm å®ä¾‹
					console.log('login_show is: ' + this.login_show);

					// this.$http.post(
					// 	'/try/ajax/demo_test_post.php',
					// 	{
					// 		name: "èœé¸Ÿæ•™ç¨‹",
					// 		url: "http://www.runoob.com"
					// 	},
					// 	{ emulateJSON: true }
					// ).then(function (res) {
					// 	console.log(res.body);
					// }, function (res) {
					// 	console.log(res.status);
					// });
					this.my_info.id = this.logform.form1;
					this.to_info.id = this.logform.form2;
					voicecol = new Voice_connecter(chatapp._data.my_info.id)
					videocol = new Video_connecter(chatapp._data.my_info.id)
					ws = new WebSocket(wurl)
					ws.onopen = function () {
						ws.send(JSON.stringify({
							'type': 'sys',
							'sender': chatapp._data.my_info.id,
							'message': {
								'type': 'login'
							}
						}))
					}

					ws.onmessage = function (e) {
						var data = JSON.parse(e.data)
						console.log("ä¸»é€šä¿¡çº¿ç¨‹æ”¶åˆ°ä¸€ä¸ªæ•°æ®:", data);
						if (data.type == "sys" & data.message.type == "logok") {
							console.log(chatapp._data.my_info.id, "ç™»å½•æˆåŠŸ");
						} else if (data.type == 'user') {
							if (data.message.type == "voicereq") {
								if (confirm(data.sender + "å‘æ‚¨æ‰“ç”µè¯") == true) {
									voicecol.login(chatapp._data.my_info.id)
									voicecol.startwith(data.sender)
								}
							} else if (data.message.type == "text") {
								chatapp.chatContentList.push(data)
								var ele = document.getElementById('chatbox');
								console.log(ele.style.top, ele.scrollHeight)

								ele.style.top = -(ele.scrollHeight - 400);
							}
						}
					}

					console.log("å‡è£…å·²ç»ç™»å½•");
					alert("å‡è£…å·²ç»ç™»å½•");
					this.login_show = false;
					console.log('login_show is: ' + this.login_show);
				},
				// clickChat: function (event) {
				// 	console.log("åœ¨chatpageç‚¹å‡»äº†:", id)
				// 	var id = event.currentTarget.dataset.id;
				// 	console.log("åœ¨chatpageç‚¹å‡»äº†:", id)

				// 	this.to_info.id = id
				// 	var idata = null
				// 	var _this = this;
				// 	$.get(serverip + ":7998/api/getChatContent.php?id=" + id, function (data, status) {
				// 		idata = JSON.parse(data)

				// 		while (app.contentList.length > 0) {
				// 			app.contentList.pop()
				// 		}

				// 		for (var i = 0; i < idata.length; i++) {
				// 			var data = {
				// 				type: "user",
				// 				sender: idata[i]["userID"],
				// 				receiver: idata[i]["friendID"],
				// 				message: {
				// 					type: "text",
				// 					time: idata[i]["time"],
				// 					content: idata[i]["data"]
				// 				}
				// 			}
				// 			app.contentList.push(data)
				// 			console.log("è·å–èŠå¤©å†…å®¹:", id, idata, data);
				// 		}
				// 		setTimeout(() => {
				// 			var ele = document.getElementById('chatbox');
				// 			console.log(ele.style.top, ele.scrollHeight)
				// 			ele.style.top = -(ele.scrollHeight - 460);
				// 		}, 460);
				// 	});
				// }
			}
		});
		neko({ el: ".wechat" });
	</script>


	<script type="text/javascript" src="js/jquery.min.js"></script>

	<script src="./lg/neko.js"></script>

	<script src="./lg/voice_tools.js"></script>
	<script src="./lg/voice_connecter.js"></script>

	<script src="./lg/video.js"></script>
	<script src="./lg/video_connecter.js"></script>

	<script src="./lg/ws_main.js"></script>
	<style>
		#hangup {
			/* . */
			width: 60px;
			height: 60px;
			background: #ddd;
			z-index: 999;
			position: absolute;
			bottom: 10px;
			margin-top: 400px;
			margin-left: 110px;
			box-sizing: border-box;
			border: 0px solid #66cc66;
			border-radius: 50%;
			background: url(./lg/hangup.jpg) no-repeat center center;
			background-size: 110% 110%;
			overflow: hidden;
			cursor: pointer
		}

		.lgtime {
			background: #aaa;
			z-index: 999;
			position: absolute;
			bottom: 30%;
			left: 45%;
			overflow: hidden;
		}
	</style>




	<!-- ç™»å½•ç•Œé¢éƒ¨åˆ† -->
	<link rel="stylesheet" type="text/css" href="css/login.css">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/vector.js"></script>
	<script type="text/javascript">
		$(function () {
			Victor("container", "output");   //ç™»é™†èƒŒæ™¯å‡½æ•°
		});
	</script>






	<!-- ç•Œé¢åŸç”Ÿéƒ¨åˆ† -->
	<script type="text/javascript" src="js/amazeui.min.js"></script>
	<script type="text/javascript" src="js/zUI.js"></script>
	<script type="text/javascript" src="js/wechat.js"></script>
	<script type="text/javascript">
		//ä¸‰å›¾æ ‡
		window.onload = function () {
			function a() {
				var si1 = document.getElementById('si_1');
				var si2 = document.getElementById('si_2');
				var si3 = document.getElementById('si_3');
				si1.onclick = function () {
					si1.style.background = "url(images/icon/head_2_1.png) no-repeat"
					si2.style.background = "";
					si3.style.background = "";
				};
				si2.onclick = function () {
					si2.style.background = "url(images/icon/head_3_1.png) no-repeat"
					si1.style.background = "";
					si3.style.background = "";
				};
				si3.onclick = function () {
					si3.style.background = "url(images/icon/head_4_1.png) no-repeat"
					si1.style.background = "";
					si2.style.background = "";
				};
			};
			a();
		};
	</script>


</body>

</html>